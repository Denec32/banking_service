# Банковская система

## Сервис регистрации клиентов и хранения транзакций

- Регистрация клиента
- Регистрации счетов клиента
- Регистрация депозитного, кредитного счетов
- Счет может быть заблокирован. Дебетовый по запросу, кредитный по исчерпанию лимита
- Запись транзакций клиента в БД
- Транзакция привязана к счету

Сервис слушает топик t1_demo_client_transactions, создает новую запись о транзакции, изменяет состояние баланса.

В случае, если счет заблокирован, отправить id ошибочной транзакции в топик t1_demo_client_transaction_errors.

В случае, если поступило сообщение об "отмене" транзакции, удалить транзакцию из БД с корректировкой баланса.

Сервис принимает http-запросы от сервиса 3 на разблокировку счета:

- Если счет кредитный и к моменту получения запроса на нем достаточно средств, то разблокировать счет и обработать транзакцию повторно

- Если средств недостаточно, то в ответном сообщении ответить отказом на запрос разблокировки

- Если счет депозитный, то просто разблокировать счет

## Сервис создания транзакций по клиенту

- Сервис получает по http-запросу информацию о транзакции по счету клиента (списание, начисление, отмена)

- Отправляет сообщение о транзакции в топик t1_demo_client_transactions

## Сервис корректировки (схема бд t1_demo_correction)

- Слушает топик t1_demo_client_transaction_errors

- При получении сообщения отправляет в сервис 1 http-запрос на разблокировку счета. При успешном ответе удалить запись о транзакции в БД, если таковая существует.

- При получении отказа на разблокировку, создать запись в БД о такой транзакции, если таковой еще не существует.

- Раз в установленный параметром период времени запускать функцию, которая достает из БД записи о таких транзакциях и повторно отправить на обработку в сервис 1.

Требования: JWT-аутентификация http-запросов, механизм блокировок записей в БД во избежание одновременной обработки